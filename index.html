<!DOCTYPE html><html lang="zh-HK">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香港的士考試練習 | Hong Kong Taxi Exam Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        .map-container {
            height: 300px;
            width: 100%;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        .summary-map {
            height: 300px;
            width: 200%;
            border-radius: 0.5rem;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold mb-2 text-primary"><button onclick="window.location.href = window.location.href;">香港的士考試練習</button></h1>
            <h2 class="text-xl mb-4">Hong Kong Taxi Exam Practice</h2>
            <p class="text-sm text-gray-600 dark:text-gray-400">基於的士筆試地方及路線試題小冊子</p>
        </header>

        <!-- Quiz Type Selection Screen -->
        <div id="quiz-selection" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-6 text-center">選擇測驗類型</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <button id="location-quiz-btn" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow hover:shadow-md border-2 border-primary flex flex-col items-center justify-center transition-all">
                    <span class="text-3xl mb-2">🏢</span>
                    <h3 class="text-xl font-bold mb-2">地方問題</h3>
                    <p class="text-sm text-center">測試你對香港地標位置的認識</p>
                </button>
                <button id="route-quiz-btn" class="p-6 bg-white dark:bg-gray-700 rounded-lg shadow hover:shadow-md border-2 border-primary flex flex-col items-center justify-center transition-all">
                    <span class="text-3xl mb-2">🛣️</span>
                    <h3 class="text-xl font-bold mb-2">路線問題 (Work in Progress)</h3>
                    <p class="text-sm text-center">測試你對香港主要路線的認識</p>
                </button>
            </div>
            
            <!-- Mistakes Review Button -->
            <button id="review-mistakes-btn" class="w-full p-4 bg-amber-500 hover:bg-amber-600 text-white rounded-lg flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                </svg>
                <span>查看以往錯誤</span>
                <span id="mistakes-count" class="bg-white text-amber-600 rounded-full h-5 min-w-5 px-1 text-xs flex items-center justify-center">0</span>
            </button>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 hidden">
            <div id="progress-bar-container" class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-4">
                <div id="progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 0%"></div>
            </div>

            <div id="stats" class="flex justify-between mb-4 text-sm">
                <div>Question: <span id="question-number">0</span>/<span id="total-questions">0</span></div>
                <div>Score: <span id="score">0</span></div>
            </div>

            <!-- Question Navigation -->
            <div id="question-nav" class="flex flex-wrap gap-2 mb-4 overflow-x-auto py-2 max-h-32 overflow-y-auto">
                <!-- Question buttons will be inserted here -->
            </div>

            <div id="question-container" class="mb-6">
                <h3 class="text-xl font-bold mb-4" id="question">Loading question...</h3>
                
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Options will be inserted here -->
                </div>
            </div>

            <div id="feedback" class="hidden mb-4 p-4 rounded-lg"></div>
            
            <!-- Map Container -->
            <div id="map-container" class="hidden mb-4">
                <div id="map" class="map-container"></div>
            </div>

            <div class="flex justify-between flex-wrap gap-3">
                <button id="exit-btn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">返回選單</button>
                <div class="flex space-x-2">
                    <button id="prev-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50">Previous</button>
                    <button id="skip-btn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 disabled:opacity-50">Skip</button>
                    <button id="next-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 disabled:opacity-50">Next</button>
                </div>
                <button id="submit-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">提交測驗</button>
            </div>
        </div>

        <!-- Summary Container -->
        <div id="summary-container" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4 text-center">測驗總覽</h2>
            <p class="text-lg mb-6 text-center">你的最終分數: <span id="summary-score" class="font-bold">0</span>/<span id="summary-total" class="font-bold">0</span></p>
            
            <div id="summary-questions" class="space-y-8">
                <!-- Questions will be inserted here -->
            </div>
            
            <button id="summary-back-btn" class="mt-6 px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 w-full">返回選擇測驗類型</button>
        </div>

        <!-- Mistakes Review Container -->
        <div id="mistakes-container" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">以往錯誤</h2>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-1">
                        <input type="checkbox" id="show-location" class="w-4 h-4" checked="">
                        <label for="show-location" class="text-sm">地方問題</label>
                    </div>
                    <div class="flex items-center gap-1">
                        <input type="checkbox" id="show-route" class="w-4 h-4" checked="">
                        <label for="show-route" class="text-sm">路線問題</label>
                    </div>
                </div>
            </div>

            <p id="no-mistakes-msg" class="text-center py-8 text-gray-500 italic hidden">目前沒有錯誤記錄</p>
            <div id="mistakes-list" class="space-y-6"></div>
            
            <div class="flex justify-between mt-6 gap-3">
                <button id="mistakes-back-btn" class="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex-1">返回選擇測驗類型</button>
                <button id="clear-mistakes-btn" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 flex-1">清除所有記錄</button>
            </div>
        </div>

        <div class="mt-4 text-center text-sm text-gray-600 dark:text-gray-400">
            <p>根據的士筆試乙部試題（地方及路線）設計</p>
            <p>資料取自運輸處，版權屬運輸處所有，僅作參考用途</p>
            <p class="mt-4">
                <a href="%E7%9A%84%E5%A3%AB%E5%89%87%E4%BE%8B%E7%B0%A1%E4%BB%8B_combined.pdf" target="_blank" class="text-primary hover:underline">按此</a>下載改良版的士則例簡介<br>
                改良版的士則例簡介取材自運輸處文件，由原先的直向排版改為橫向，更便於閲讀<br>
                請參閲運輸處網站以獲取最新版本
            </p>
            <p class="mt-4">
                如閣下有任何意見或發現本網站出錯，請<a href="http://forms.gle/9kmEMKaL7KugCnMv7" target="_blank" class="text-primary hover:underline">到此與我們聯絡</a>，謝謝！
            </p>
        </div>
    </div>

    <script>
        // Check and set dark mode based on user preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Map variables
        let map = null;
        const mapContainer = document.getElementById('map-container');
        const mapElement = document.getElementById('map');

        // Location quiz data
        locationQuizData = [
            { place: "瑪麗醫院", location: "薄扶林", lat: 22.269962, lng: 114.1312907 },
            { place: "威爾斯親王醫院", location: "沙田", lat: 22.38125, lng: 114.20162 },
            { place: "贊育醫院", location: "西營盤", lat: 22.2861959, lng: 114.1445947 },
            { place: "東華醫院", location: "上環", lat: 22.285101, lng: 114.146545 },
            { place: "東華三院馮堯敬醫院", location: "薄扶林", lat: 22.2714702, lng: 114.1248484 },
            { place: "葛量洪醫院", location: "黃竹坑", lat: 22.2459198, lng: 114.1664957 },
            { place: "東區尤德夫人那打素醫院", location: "柴灣", lat: 22.2695993, lng: 114.2362653 },
            { place: "東華東院", location: "大坑", lat: 22.2754598, lng: 114.1908047 },
            { place: "鄧肇堅醫院", location: "灣仔", lat: 22.2755944, lng: 114.1777194 },
            { place: "律敦治醫院", location: "灣仔", lat: 22.2758454, lng: 114.1753051 },
            { place: "黃竹坑醫院", location: "黃竹坑徑", lat: 22.2510939, lng: 114.1759364 },
            { place: "伊利沙伯醫院", location: "油麻地", lat: 22.3086169, lng: 114.1747227 },
            { place: "九龍醫院", location: "九龍城", lat: 22.3306602, lng: 114.1920172 },
            { place: "香港佛教醫院", location: "樂富", lat: 22.3356331, lng: 114.1883828 },
            { place: "香港眼科醫院", location: "九龍城", lat: 22.3249163, lng: 114.1845098 },
            { place: "東華三院黃大仙醫院", location: "沙田坳道", lat: 22.3469363, lng: 114.196536 },
            { place: "聖母醫院", location: "黃大仙", lat: 22.3456548, lng: 114.1966145 },
            { place: "廣華醫院", location: "油麻地", lat: 22.3144134, lng: 114.1722412 },
            { place: "明愛醫院", location: "長沙灣", lat: 22.340074, lng: 114.151591 },
            { place: "瑪嘉烈醫院", location: "荔景", lat: 22.341361, lng: 114.1338213 },
            { place: "葵涌醫院", location: "荔景", lat: 22.3429092, lng: 114.1336731 },
            { place: "仁濟醫院", location: "荃灣", lat: 22.369918, lng: 114.119485 },
            { place: "基督教聯合醫院", location: "秀茂坪", lat: 22.3234273, lng: 114.2275646 },
            { place: "靈實醫院", location: "將軍澳", lat: 22.3141786, lng: 114.2564677 },
            { place: "將軍澳醫院", location: "寶寧里", lat: 22.3182761, lng: 114.2697606 },
            { place: "沙田醫院", location: "亞公角街", lat: 22.398076, lng: 114.212764 },
            { place: "雅麗氏何妙齡那打素醫院", location: "大埔", lat: 22.4586917, lng: 114.1747667 },
            { place: "大埔醫院", location: "全安路", lat: 22.4612811, lng: 114.1747755 },
            { place: "北區醫院", location: "上水", lat: 22.4968697, lng: 114.1246908 },
            { place: "屯門醫院", location: "青松觀路", lat: 22.407486, lng: 113.976323 },
            { place: "博愛醫院", location: "元朗", lat: 22.4445484, lng: 114.0222095 },
            { place: "嘉諾撒醫院", location: "半山", lat: 22.2773652, lng: 114.1538561 },
            { place: "明德國際醫院", location: "山頂", lat: 22.259805, lng: 114.149526 },
            { place: "香港港安醫院", location: "跑馬地", lat: 22.2634133, lng: 114.1841954 },
            { place: "聖保祿醫院", location: "東院道", lat: 22.278467, lng: 114.1882198 },
            { place: "養和醫院", location: "跑馬地", lat: 22.269235, lng: 114.1830406 },
            { place: "寶血醫院（明愛）", location: "深水埗", lat: 22.3338708, lng: 114.1617508 },
            { place: "播道醫院", location: "九龍城", lat: 22.3251652, lng: 114.1869162 },
            { place: "聖德肋撒醫院", location: "九龍城", lat: 22.3262591, lng: 114.184829 },
            { place: "香港浸信會醫院", location: "九龍塘", lat: 22.3398475, lng: 114.1798555 },
            { place: "荃灣港安醫院", location: "荃景圍", lat: 22.3767395, lng: 114.1042874 },
            { place: "沙田國際醫務中心仁安醫院", location: "富健街", lat: 22.3606398, lng: 114.1752751 },
            { place: "青山醫院", location: "屯門", lat: 22.408538, lng: 113.9737562 },
            { place: "小欖醫院", location: "青松觀路", lat: 22.4100517, lng: 113.9748925 },
            { place: "大口環根德公爵夫人兒童醫院", location: "薄扶林", lat: 22.2711651, lng: 114.1234051 },
            { place: "北大嶼山醫院", location: "松仁路", lat: 22.2820281, lng: 113.9392707 },
            { place: "天水圍醫院", location: "天壇街", lat: 22.4584632, lng: 113.9958452 },
            { place: "港怡醫院", location: "黃竹坑", lat: 22.2515672, lng: 114.1763966 },
            { place: "香港兒童醫院", location: "九龍灣", lat: 22.3152999, lng: 114.209468 },
            { place: "香港中文大學醫院", location: "澤祥街", lat: 22.4136093, lng: 114.2113817 },
            { place: "星光大道", location: "尖沙咀", lat: 22.2930046, lng: 114.1741517 },
            { place: "金紫荊廣場", location: "灣仔", lat: 22.284425, lng: 114.1739009 },
            { place: "香港迪士尼樂園", location: "竹篙灣", lat: 22.3129666, lng: 114.0412819 },
            { place: "香港濕地公園", location: "天水圍", lat: 22.4700585, lng: 114.0065831 },
            { place: "玉器市場", location: "油麻地", lat: 22.3095032, lng: 114.1700524 },
            { place: "九龍寨城公園", location: "九龍城", lat: 22.3321296, lng: 114.1903285 },
            { place: "昂坪纜車 - 東涌纜車站", location: "達東路", lat: 22.290337, lng: 113.938363 },
            { place: "香港海洋公園", location: "黃竹坑", lat: 22.2466607, lng: 114.1757239 },
            { place: "寶蓮禪寺", location: "昂坪", lat: 22.2554806, lng: 113.9078801 },
            { place: "凌霄閣", location: "山頂道", lat: 22.2712357, lng: 114.1499638 },
            { place: "亞洲國際博覽館", location: "赤鱲角", lat: 22.321343, lng: 113.943288 },
            { place: "屏山文物徑", location: "元朗", lat: 22.4461535, lng: 114.0060257 },
            { place: "香港會議展覽中心", location: "灣仔", lat: 22.2833754, lng: 114.1731385 },
            { place: "香港文化博物館", location: "沙田", lat: 22.3770481, lng: 114.1857103 },
            { place: "香港歷史博物館", location: "尖沙咀", lat: 22.3018851, lng: 114.1772612 },
            { place: "香港科學館", location: "尖沙咀", lat: 22.301388, lng: 114.1765585 },
            { place: "香港太空館", location: "尖沙咀", lat: 22.2942262, lng: 114.1718723 },
            { place: "香港大會堂", location: "中環", lat: 22.2822389, lng: 114.1616361 },
            { place: "香港體育館", location: "紅磡", lat: 22.3012694, lng: 114.182023 },
            { place: "香港文化中心", location: "尖沙咀", lat: 22.2938496, lng: 114.1703232 },
            { place: "伊利沙伯體育館", location: "灣仔", lat: 22.2751248, lng: 114.1790164 },
            { place: "沙田大會堂", location: "源禾路", lat: 22.3812484, lng: 114.1899337 },
            { place: "尖沙咀天星碼頭", location: "尖沙咀", lat: 22.293763, lng: 114.168748 },
            { place: "1881", location: "廣東道", lat: 22.2954731, lng: 114.1699524 },
            { place: "沙田車公廟", location: "大圍", lat: 22.373419, lng: 114.182831 },
            { place: "文武廟", location: "上環", lat: 22.2839729, lng: 114.1501999 },
            { place: "林村許願廣場", location: "大埔", lat: 22.4567851, lng: 114.1424556 },
            { place: "龍躍頭文物徑", location: "粉嶺", lat: 22.4992066, lng: 114.1520523 },
            { place: "美利樓", location: "赤柱", lat: 22.2180281, lng: 114.2097775 },
            { place: "和昌大押", location: "莊士敦道", lat: 22.2763125, lng: 114.1714565 },
            { place: "大館", location: "荷李活道", lat: 22.2811686, lng: 114.154023 },
            { place: "香港藝術館", location: "尖沙咀", lat: 22.2936055, lng: 114.1721324 },
            { place: "啟德郵輪碼頭", location: "承豐道", lat: 22.3061156, lng: 114.2132375 },
            { place: "香港故宮文化博物館", location: "博物館道", lat: 22.30177, lng: 114.1564 },
            { place: "戲曲中心", location: "柯士甸道西", lat: 22.3021749, lng: 114.1672715 },
            { place: "8度海逸酒店", location: "土瓜灣", lat: 22.3229344, lng: 114.1906691 },
            { place: "九龍海逸君綽酒店", location: "紅磡", lat: 22.302697, lng: 114.1923311 },
            { place: "九龍維景酒店", location: "何文田", lat: 22.3194297, lng: 114.1758412 },
            { place: "九龍酒店", location: "尖沙咀", lat: 22.2957152, lng: 114.1717745 },
            { place: "九龍香格里拉大酒店", location: "尖沙咀", lat: 22.297137, lng: 114.1770839 },
            { place: "六國酒店", location: "灣仔", lat: 22.278865, lng: 114.172354 },
            { place: "北角海逸酒店", location: "英皇道", lat: 22.2915378, lng: 114.2086321 },
            { place: "千禧新世界香港酒店", location: "尖沙咀", lat: 22.2988123, lng: 114.1721746 },
            { place: "君怡酒店", location: "尖沙咀", lat: 22.3005109, lng: 114.1737953 },
            { place: "嘉湖海逸酒店", location: "天水圍", lat: 22.4575256, lng: 114.0043749 },
            { place: "富豪九龍酒店", location: "尖沙咀", lat: 22.298849, lng: 114.178027 },
            { place: "富豪東方酒店", location: "九龍城", lat: 22.3300395, lng: 114.1929201 },
            { place: "富豪香港酒店", location: "銅鑼灣", lat: 22.279153, lng: 114.186825 },
            { place: "帝京酒店", location: "旺角", lat: 22.3242126, lng: 114.17312 },
            { place: "帝景酒店", location: "汀九", lat: 22.3684504, lng: 114.0780214 },
            { place: "帝苑酒店", location: "尖沙咀", lat: 22.298656, lng: 114.177338 },
            { place: "帝都酒店", location: "沙田", lat: 22.3798552, lng: 114.1884978 },
            { place: "柏寧酒店", location: "銅鑼灣", lat: 22.2811814, lng: 114.1864262 },
            { place: "港島英迪格酒店", location: "灣仔", lat: 22.2748068, lng: 114.1733125 },
            { place: "皇家太平洋酒店", location: "尖沙咀", lat: 22.3001702, lng: 114.1680287 },
            { place: "諾富特東薈城酒店", location: "東涌", lat: 22.291156, lng: 113.9423551 },
            { place: "都會海逸酒店", location: "紅磡", lat: 22.3013425, lng: 114.1832283 },
            { place: "香港半島酒店", location: "尖沙咀", lat: 22.2951024, lng: 114.1718537 },
            { place: "香港君悅酒店", location: "灣仔", lat: 22.2811128, lng: 114.1719657 },
            { place: "香港喜來登酒店", location: "尖沙咀", lat: 22.2952177, lng: 114.17261 },
            { place: "香港四季酒店", location: "中環", lat: 22.2866377, lng: 114.156647 },
            { place: "香港天際萬豪酒店", location: "赤鱲角", lat: 22.317823, lng: 113.943278 },
            { place: "香港康得思酒店", location: "上海街", lat: 22.318175, lng: 114.168112 },
            { place: "香港文華東方酒店", location: "中環", lat: 22.2818794, lng: 114.1594433 },
            { place: "香港朗廷酒店", location: "尖沙咀", lat: 22.2963977, lng: 114.1697461 },
            { place: "香港沙田凱悅酒店", location: "澤祥街", lat: 22.4117216, lng: 114.2112101 },
            { place: "香港麗晶酒店", location: "尖沙咀", lat: 22.2934362, lng: 114.1739346 },
            { place: "香港港麗酒店", location: "金鐘", lat: 22.2766755, lng: 114.1654058 },
            { place: "香港灣仔帝盛酒店", location: "皇后大道東", lat: 22.274559, lng: 114.178936 },
            { place: "香港珀麗酒店", location: "銅鑼灣", lat: 22.2791667, lng: 114.1883333 },
            { place: "香港百樂酒店", location: "尖沙咀", lat: 22.2996441, lng: 114.1754722 },
            { place: "粵海華美灣際酒店", location: "灣仔", lat: 22.2783586, lng: 114.1711064 },
            { place: "香港萬麗海景酒店", location: "灣仔", lat: 22.2814527, lng: 114.1738372 },
            { place: "香港諾富特世紀酒店", location: "灣仔", lat: 22.2788043, lng: 114.176386 },
            { place: "香港金域假日酒店", location: "尖沙咀", lat: 22.2967855, lng: 114.1727739 },
            { place: "香港銅鑼灣皇冠假日酒店", location: "禮頓道", lat: 22.2769914, lng: 114.1826942 },
            { place: "香港黃金海岸酒店", location: "掃管笏", lat: 22.3717971, lng: 113.9894773 },
            { place: "馬哥孛羅香港酒店", location: "尖沙咀", lat: 22.2951648, lng: 114.1688605 },
            { place: "麗豪酒店", location: "沙田", lat: 22.3822082, lng: 114.1963102 },
            { place: "香港維港凱悅尚萃酒店", location: "北角", lat: 22.292768, lng: 114.1989849 },
            { place: "唯港薈", location: "尖沙咀", lat: 22.3007586, lng: 114.1796973 },
            { place: "奧華酒店南岸", location: "黃竹坑", lat: 22.2459198, lng: 114.1664957 },
            { place: "南灣如心酒店", location: "香港仔", lat: 22.2496433, lng: 114.1681462 },
            { place: "荃灣西如心酒店", location: "楊屋道", lat: 22.3685909, lng: 114.1129769 },
            { place: "九龍東如心酒店", location: "觀塘", lat: 22.3141482, lng: 114.219058 },
            { place: "銅鑼灣如心酒店", location: "英皇道", lat: 22.2832644, lng: 114.192838 },
            { place: "富豪機場酒店會議中心", location: "赤鱲角", lat: 22.3186949, lng: 113.9343274 },
            { place: "尖沙咀皇悅酒店", location: "金巴利道", lat: 22.3010058, lng: 114.1751035 },
            { place: "海景嘉福洲際酒店", location: "尖沙咀", lat: 22.2990526, lng: 114.1793931 },
            { place: "港威酒店", location: "尖沙咀", lat: 22.297756, lng: 114.168542 },
            { place: "港島海逸君綽酒店", location: "北角", lat: 22.2890067, lng: 114.1918459 },
            { place: "港島皇悅酒店", location: "軒尼詩道", lat: 22.2778068, lng: 114.1701009 },
            { place: "港島香格里拉大酒店", location: "法院道", lat: 22.2771904, lng: 114.1644241 },
            { place: "美麗華酒店", location: "尖沙咀", lat: 22.3003264, lng: 114.1722504 },
            { place: "華美達海景酒店", location: "皇后大道西", lat: 22.28699, lng: 114.1435312 },
            { place: "迪士尼好萊塢酒店", location: "大嶼山", lat: 22.309187, lng: 114.037334 },
            { place: "迪士尼探索家度假酒店", location: "竹篙灣", lat: 22.3081634, lng: 114.0386053 },
            { place: "銅鑼灣皇悅酒店", location: "永興街", lat: 22.2852143, lng: 114.192247 },
            { place: "香港W酒店", location: "柯士甸道西", lat: 22.3048255, lng: 114.1605667 },
            { place: "香港JW萬豪酒店", location: "金鐘道", lat: 22.277509, lng: 114.166341 },
            { place: "香港九龍東皇冠假日酒店", location: "將軍澳", lat: 22.3085223, lng: 114.2600823 },
            { place: "香港嘉里酒店", location: "紅磡", lat: 22.3013479, lng: 114.1882474 },
            { place: "香港尖沙咀凱悦酒店", location: "河內道", lat: 22.2974584, lng: 114.1740116 },
            { place: "香港屯門貝爾特酒店", location: "震寰路", lat: 22.3956509, lng: 113.9718717 },
            { place: "香港旺角帝盛酒店", location: "大角咀", lat: 22.3212732, lng: 114.1622125 },
            { place: "香港東隅", location: "鰂魚涌", lat: 22.2860064, lng: 114.2160626 },
            { place: "香港沙田萬怡酒店", location: "安平街", lat: 22.3907979, lng: 114.2063027 },
            { place: "名迪港島酒店", location: "摩頓臺", lat: 22.2791385, lng: 114.1892003 },
            { place: "香港瑰麗酒店", location: "尖沙咀", lat: 22.2949764, lng: 114.175832 },
            { place: "香港美利酒店", location: "中環", lat: 22.2780806, lng: 114.160106 },
            { place: "香港萬怡酒店", location: "干諾道西", lat: 22.2879503, lng: 114.1388476 },
            { place: "香港觀塘帝盛酒店", location: "鴻圖道", lat: 22.3080189, lng: 114.2242966 },
            { place: "香港迪士尼樂園酒店", location: "竹篙灣", lat: 22.3081194, lng: 114.0440642 },
            { place: "香港逸東酒店", location: "佐敦", lat: 22.3080409, lng: 114.1717101 },
            { place: "香港麗思卡爾頓酒店", location: "柯士甸道西", lat: 22.3034032, lng: 114.1601907 },
            { place: "帝逸酒店", location: "沙田", lat: 22.3836116, lng: 114.208223 },
            { place: "WM酒店", location: "西貢", lat: 22.385398, lng: 114.2755701 },
            { place: "歷山酒店", location: "北角", lat: 22.2895605, lng: 114.1927027 },
            { place: "香港瑞吉酒店", location: "灣仔", lat: 22.2801126, lng: 114.174828 },
            { place: "香港東涌世茂喜來登酒店", location: "怡東路", lat: 22.2956594, lng: 113.9461967 },
            { place: "香港富麗敦海洋公園酒店", location: "香港仔", lat: 22.2369121, lng: 114.1655464 },
            { place: "麗豪航天城酒店", location: "赤鱲角", lat: 22.3192383, lng: 113.9420082 },
            { place: "北角政府合署", location: "渣華道", lat: 22.2922788, lng: 114.2084053 },
            { place: "長沙灣政府合署", location: "長沙灣道", lat: 22.3317857, lng: 114.1602236 },
            { place: "何文田政府合署", location: "忠孝街", lat: 22.314562, lng: 114.180343 },
            { place: "東九龍政府合署", location: "觀塘", lat: 22.309595, lng: 114.22978 },
            { place: "九龍政府合署", location: "油麻地", lat: 22.30943, lng: 114.1709404 },
            { place: "葵興政府合署", location: "興芳路", lat: 22.3630657, lng: 114.1315536 },
            { place: "荔枝角政府合署", location: "荔灣道", lat: 22.3401238, lng: 114.1385356 },
            { place: "馬頭角道政府合署", location: "馬頭角道", lat: 22.3228029, lng: 114.1872614 },
            { place: "旺角政府合署", location: "聯運街", lat: 22.321378, lng: 114.1725951 },
            { place: "梅窩政府合署", location: "銀鑛灣路", lat: 22.2661676, lng: 113.99792 },
            { place: "牛頭角政府合署", location: "安華街", lat: 22.3212222, lng: 114.2166788 },
            { place: "北區政府合署", location: "粉嶺", lat: 22.4945671, lng: 114.1383114 },
            { place: "培正道政府合署", location: "何文田", lat: 22.318301, lng: 114.177412 },
            { place: "西貢政府合署", location: "親民街", lat: 22.3820295, lng: 114.2724391 },
            { place: "沙田政府合署", location: "上禾輋路", lat: 22.385632, lng: 114.186962 },
            { place: "深水埗政府合署", location: "元州街", lat: 22.3319772, lng: 114.163557 },
            { place: "大興政府合署", location: "屯門", lat: 22.3998411, lng: 113.973491 },
            { place: "大埔政府合署", location: "汀角路", lat: 22.450742, lng: 114.164568 },
            { place: "土瓜灣政府合署", location: "馬頭圍道", lat: 22.3171467, lng: 114.1880584 },
            { place: "荃灣政府合署", location: "西樓角路", lat: 22.3742679, lng: 114.1155801 },
            { place: "屯門政府合署", location: "屯喜路", lat: 22.390367, lng: 113.976285 },
            { place: "元朗政府合署", location: "橋樂坊", lat: 22.4455556, lng: 114.0269444 },
            { place: "觀塘區警署", location: "鯉魚門道", lat: 22.3037818, lng: 114.2359347 },
            { place: "旺角區警署", location: "太子道西", lat: 22.3243407, lng: 114.1690247 },
            { place: "將軍澳區警署", location: "寶琳北路", lat: 22.3201431, lng: 114.2540285 },
            { place: "荃灣區警署", location: "荃景圍", lat: 22.3764562, lng: 114.1072809 },
            { place: "中區警區總部", location: "中港道", lat: 22.2891444, lng: 114.1482347 },
            { place: "東區法院大樓", location: "西灣河", lat: 22.2843535, lng: 114.224114 },
            { place: "終審法院", location: "中環", lat: 22.2809198, lng: 114.1603532 },
            { place: "立法會綜合大樓", location: "金鐘", lat: 22.281171, lng: 114.166369 },
            { place: "香港禮賓府", location: "中環", lat: 22.2786766, lng: 114.1574514 },
            { place: "香港中央圖書館", location: "銅鑼灣", lat: 22.2799098, lng: 114.1896618 },
            { place: "醫院管理局大樓", location: "九龍城", lat: 22.3243594, lng: 114.1832294 },
            { place: "九龍城法院大樓", location: "亞皆老街", lat: 22.3252213, lng: 114.1852566 },
            { place: "觀塘法院大樓", location: "鯉魚門道", lat: 22.3097598, lng: 114.2293906 },
            { place: "粉嶺法院大樓", location: "璧峰路", lat: 22.4955616, lng: 114.139092 },
            { place: "沙田法院大樓", location: "宜正里", lat: 22.3800532, lng: 114.1890913 },
            { place: "屯門法院大樓", location: "屯喜路", lat: 22.390278, lng: 113.975556 },
            { place: "西九龍法院大樓", location: "通州街", lat: 22.3312583, lng: 114.1530395 },
            { place: "高等法院", location: "金鐘道", lat: 22.2783669, lng: 114.1633505 },
            { place: "勞資審裁處", location: "加士居道", lat: 22.3078471, lng: 114.1730104 },
            { place: "土地審裁處", location: "加士居道", lat: 22.308285, lng: 114.172734 },
            { place: "區域法院", location: "港灣道", lat: 22.2801948, lng: 114.1724004 },
            { place: "西九龍政府合署", location: "海庭道", lat: 22.3125331, lng: 114.1635216 },
            { place: "入境事務處總部", location: "將軍澳", lat: 22.3056152, lng: 114.2574336 },
            { place: "機電工程署總部大樓", location: "啟成街", lat: 22.3258736, lng: 114.2035786 },
            { place: "中環中心", location: "皇后大道中", lat: 22.2846202, lng: 114.1547347 },
            { place: "如心廣場", location: "荃灣", lat: 22.368611, lng: 114.113056 },
            { place: "長江集團中心", location: "中環", lat: 22.2794704, lng: 114.1603101 },
            { place: "利園", location: "銅鑼灣", lat: 22.278333, lng: 114.184611 },
            { place: "新鴻基中心", location: "灣仔", lat: 22.2804712, lng: 114.176978 },
            { place: "華懋交易廣場", location: "鰂魚涌", lat: 22.2880754, lng: 114.2117901 },
            { place: "力寶中心", location: "金鐘", lat: 22.279536, lng: 114.16335 },
            { place: "美麗華廣場", location: "尖沙咀", lat: 22.3010487, lng: 114.1722875 },
            { place: "太古廣場", location: "金鐘", lat: 22.2772459, lng: 114.1649087 },
            { place: "英國保誠保險大樓", location: "尖沙咀", lat: 22.298729, lng: 114.167775 },
            { place: "中國太平大廈", location: "新寧道", lat: 22.2779109, lng: 114.1855686 },
            { place: "電視廣播有限公司電視廣播城", location: "將軍澳", lat: 22.3089111, lng: 114.2635572 },
            { place: "港威大廈", location: "尖沙咀", lat: 22.2974784, lng: 114.1687395 },
            { place: "貿易廣場", location: "長沙灣", lat: 22.336875, lng: 114.154192 },
            { place: "海富中心", location: "夏慤道", lat: 22.279531, lng: 114.165196 },
            { place: "統一中心", location: "金鐘", lat: 22.2784312, lng: 114.1654177 },
            { place: "環球大廈", location: "中環", lat: 22.2825285, lng: 114.1578668 },
            { place: "國際金融中心", location: "中環", lat: 22.285, lng: 114.159167 },
            { place: "環球貿易廣場", location: "柯士甸道西", lat: 22.3034032, lng: 114.1601907 },
            { place: "中環廣場", location: "港灣道", lat: 22.2799097, lng: 114.1737282 },
            { place: "中銀大廈", location: "花園道", lat: 22.2793043, lng: 114.1614931 },
            { place: "港島東中心", location: "鰂魚涌", lat: 22.2862479, lng: 114.2135458 },
            { place: "中遠大廈", location: "皇后大道中", lat: 22.2855335, lng: 114.1529461 },
            { place: "怡和大廈", location: "中環", lat: 22.2830289, lng: 114.1589161 },
            { place: "永安集團大廈", location: "德輔道中", lat: 22.283883, lng: 114.156478 },
            { place: "香港滙豐總行大廈", location: "中環", lat: 22.2801958, lng: 114.1593852 },
            { place: "合和中心", location: "灣仔", lat: 22.2746386, lng: 114.1717253 },
            { place: "圓方", location: "柯士甸道西", lat: 22.3046472, lng: 114.1611085 },
            { place: "又一城", location: "達之路", lat: 22.337381, lng: 114.1744322 },
            { place: "海港城", location: "尖沙咀", lat: 22.2953381, lng: 114.1688303 },
            { place: "置地廣場", location: "中環", lat: 22.2799907, lng: 114.1587983 },
            { place: "上水廣場", location: "龍琛路", lat: 22.5025848, lng: 114.1279107 },
            { place: "朗豪坊", location: "旺角", lat: 22.3182116, lng: 114.1686743 },
            { place: "荷里活廣場", location: "鑽石山", lat: 22.3405929, lng: 114.2020184 },
            { place: "時代廣場", location: "銅鑼灣", lat: 22.278151, lng: 114.1821136 },
            { place: "西港城", location: "上環", lat: 22.287287, lng: 114.150392 },
            { place: "黃埔新天地", location: "紅磡", lat: 22.3047243, lng: 114.1903547 },
            { place: "元創方", location: "鴨巴甸街", lat: 22.2834497, lng: 114.1517343 },
            { place: "世貿中心", location: "告士打道", lat: 22.2819499, lng: 114.1841731 },
            { place: "K11購物藝術館", location: "河內道", lat: 22.297525, lng: 114.1736355 },
            { place: "青衣城", location: "青敬路", lat: 22.3584265, lng: 114.1081419 },
            { place: "新城市廣場", location: "沙田", lat: 22.3817578, lng: 114.1886372 },
            { place: "奧海城2期", location: "海庭道", lat: 22.3167357, lng: 114.1615929 },
            { place: "崇光銅鑼灣店", location: "軒尼詩道", lat: 22.2804272, lng: 114.1843032 },
            { place: "屯門市廣場", location: "屯順街", lat: 22.3929235, lng: 113.9761594 },
            { place: "中港城", location: "尖沙咀", lat: 22.3005315, lng: 114.1678015 },
            { place: "東薈城名店倉", location: "東涌", lat: 22.2896486, lng: 113.9405428 },
            { place: "利舞臺", location: "銅鑼灣", lat: 22.2782879, lng: 114.1831818 },
            { place: "南豐紗廠", location: "白田壩街", lat: 22.3750707, lng: 114.1101695 },
            { place: "K11人文購物藝術館", location: "梳士巴利道", lat: 22.2941573, lng: 114.1739272 },
            { place: "裕民坊", location: "觀塘", lat: 22.3135903, lng: 114.224767 },
            { place: "AIRSIDE", location: "啟德", lat: 22.331322, lng: 114.198142 },
            { place: "圍方", location: "車公廟路", lat: 22.3725863, lng: 114.1797535 },
            { place: "APM", location: "觀塘", lat: 22.312401, lng: 114.225222 },
            { place: "V Walk", location: "深旺道", lat: 22.3270845, lng: 114.1543942 },
            { place: "德福花園", location: "偉業街", lat: 22.32237, lng: 114.212493 },
            { place: "淘大花園", location: "九龍灣", lat: 22.3244614, lng: 114.2163021 },
            { place: "匯景花園", location: "藍田", lat: 22.3069935, lng: 114.2331127 },
            { place: "綠楊新邨", location: "荃灣", lat: 22.3723225, lng: 114.1218025 },
            { place: "盈翠半島", location: "青衣", lat: 22.3582411, lng: 114.1071474 },
            { place: "港灣豪庭", location: "福利街", lat: 22.3244104, lng: 114.1603631 },
            { place: "新屯門中心", location: "龍門路", lat: 22.3812677, lng: 113.9643338 },
            { place: "錦綉花園", location: "元朗", lat: 22.4780591, lng: 114.0443408 },
            { place: "嘉湖山莊", location: "天水圍", lat: 22.4565729, lng: 114.0023946 },
            { place: "美孚新邨", location: "荔枝角", lat: 22.3366356, lng: 114.1402195 },
            { place: "太古城", location: "鰂魚涌", lat: 22.2865471, lng: 114.2189883 },
            { place: "沙田第一城", location: "小瀝源路", lat: 22.3877476, lng: 114.2044876 },
            { place: "黃埔花園", location: "紅磡", lat: 22.3037908, lng: 114.1892659 },
            { place: "海怡半島", location: "鴨脷洲", lat: 22.243373, lng: 114.1476512 },
            { place: "麗港城", location: "觀塘", lat: 22.30606, lng: 114.2279046 },
            { place: "愉景灣", location: "大嶼山", lat: 22.2921406, lng: 114.0101467 },
            { place: "新都城", location: "寶林", lat: 22.3227989, lng: 114.2574486 },
            { place: "杏花邨", location: "柴灣", lat: 22.2678103, lng: 114.2360778 },
            { place: "麗城花園", location: "荃灣", lat: 22.3717381, lng: 114.1012016 },
            { place: "映灣園", location: "東涌", lat: 22.2922883, lng: 113.948814 },
            { place: "珀麗灣", location: "馬灣", lat: 22.3532151, lng: 114.0614369 },
            { place: "維景灣畔", location: "調景嶺", lat: 22.3080954, lng: 114.2529567 },
            { place: "海逸豪園", location: "紅磡", lat: 22.307797, lng: 114.1926098 },
            { place: "置富花園", location: "薄扶林", lat: 22.2580367, lng: 114.1391702 },
            { place: "將軍澳中心", location: "唐德街", lat: 22.3074503, lng: 114.2572761 },
            { place: "大埔中心", location: "安邦路", lat: 22.451529, lng: 114.169121 },
            { place: "東堤灣畔", location: "東涌", lat: 22.2880911, lng: 113.9398923 },
            { place: "新港城", location: "馬鞍山", lat: 22.4241643, lng: 114.2318055 },
            { place: "富榮花園", location: "海庭道", lat: 22.3140442, lng: 114.1629658 },
            { place: "海山樓", location: "鰂魚涌", lat: 22.2842103, lng: 114.2119759 },
            { place: "嘉匯", location: "沐寧街", lat: 22.3285812, lng: 114.2012303 },
            { place: "擎天半島", location: "柯士甸道西", lat: 22.3068099, lng: 114.1615387 },
            { place: "形點", location: "朗日路", lat: 22.445713, lng: 114.0353169 },
            { place: "香港恒生大學", location: "小瀝源", lat: 22.3795293, lng: 114.2114767 },
            { place: "香港城市大學", location: "九龍塘", lat: 22.3370342, lng: 114.17272 },
            { place: "香港浸會大學", location: "九龍塘", lat: 22.3408088, lng: 114.1798757 },
            { place: "香港樹仁大學", location: "北角", lat: 22.286178, lng: 114.197825 },
            { place: "嶺南大學", location: "屯門", lat: 22.4109705, lng: 113.9830974 },
            { place: "香港中文大學", location: "沙田", lat: 22.419625, lng: 114.2067606 },
            { place: "香港教育大學", location: "大埔", lat: 22.4670285, lng: 114.1936333 },
            { place: "香港理工大學", location: "紅磡", lat: 22.3045633, lng: 114.1795767 },
            { place: "香港科技大學", location: "清水灣", lat: 22.3207164, lng: 114.2713158 },
            { place: "香港都會大學", location: "何文田", lat: 22.3163552, lng: 114.1801817 },
            { place: "香港大學本部大樓", location: "般咸道", lat: 22.2840174, lng: 114.1378437 },
            { place: "聖方濟各大學", location: "翠嶺里", lat: 22.3035509, lng: 114.2507898 }
        ]

        // Route quiz data
        const routeQuizData = [
            { 
                startPoint: "沙田富豪花園", 
                endPoint: "屯門市廣場", 
                route: "城門隧道公路、城門隧道、象鼻山路、屯門公路、屯喜路、屯隆街及屯順街"
            },
            { 
                startPoint: "深水埗南昌邨", 
                endPoint: "港鐵上水站", 
                route: "深旺道、連翔道、青沙公路、尖山隧道、吐露港公路、粉嶺公路及新運路"
            },
            { 
                startPoint: "西貢匡湖居", 
                endPoint: "大口環根德公爵夫人兒童醫院", 
                route: "清水灣道、太子道東、亞皆老街、櫻桃街、西區海底隧道、干諾道西、城西道、域多利道及大口環道"
            },
            { 
                startPoint: "旺角麥花臣遊樂場", 
                endPoint: "海洋公園", 
                route: "山東街、染布房街、衛理道、康莊道、紅磡海底隧道、香港仔隧道及海洋公園道"
            },
            { 
                startPoint: "香港大學", 
                endPoint: "太古城中心", 
                route: "薄扶林道、干諾道西、中環及灣仔繞道隧道、東區走廊、太古灣道及太古城道"
            },
            { 
                startPoint: "紅磡高山劇場", 
                endPoint: "長沙灣廣場", 
                route: "信用街、佛光街、培正道、梭椏道、亞皆老街、彌敦道、荔枝角道、大南西街及長沙灣道"
            },
            { 
                startPoint: "荃灣沙咀道遊樂場", 
                endPoint: "沙田中心", 
                route: "大河道、象鼻山道、城門隧道、沙田鄉事會路、源禾路及担杆莆街"
            },
            { 
                startPoint: "九龍塘香港浸會大學大學會堂", 
                endPoint: "灣仔鷹君中心", 
                route: "窩打老道、公主道、紅磡海底隧道、告士打道及港灣道"
            },
            { 
                startPoint: "九龍公共圖書館", 
                endPoint: "跑馬地馬場", 
                route: "培正道、公主道、康莊道、紅磡海底隧道、堅拿道天橋及黃泥涌道"
            },
            { 
                startPoint: "長沙灣政府合署", 
                endPoint: "觀塘區警署", 
                route: "長沙灣道、界限街、太子道東、觀塘道及鯉魚門道"
            },
            { 
                startPoint: "西九文化區戲曲中心", 
                endPoint: "九龍灣德福廣場", 
                route: "柯士甸道、漆咸道北、東九龍走廊、啟德隧道、啟福道及偉業街"
            },
            { 
                startPoint: "觀塘秀茂坪邨", 
                endPoint: "香港中央圖書館", 
                route: "秀茂坪道、將軍澳道、啟田道、東區海底隧道、英皇道及高士威道"
            },
            { 
                startPoint: "海富中心", 
                endPoint: "葵興政府合署", 
                route: "德立街、夏慤道、告士打道、紅磡海底隧道、西九龍走廊、葵涌道及興芳路"
            },
            { 
                startPoint: "青衣灝景灣", 
                endPoint: "沙田車公廟", 
                route: "青衣鄉事會路、青衣南橋、呈祥道、青沙公路、尖山隧道、車公廟路及翠田街"
            },
            { 
                startPoint: "鴨脷洲利東邨", 
                endPoint: "佐敦拔萃女書院", 
                route: "鴨脷洲大橋、香港仔隧道、紅磡海底隧道、加士居道及佐敦道"
            },
            { 
                startPoint: "上水廣場", 
                endPoint: "入境事務處總部", 
                route: "粉嶺公路、吐露港公路﹑大老山公路﹑大老山隧道﹑觀塘繞道﹑將軍澳道﹑環保大道及寶邑路"
            },
            { 
                startPoint: "九龍塘商業電台", 
                endPoint: "電視廣播城", 
                route: "廣播道、竹園道、龍翔道、觀塘道、將軍澳道、環保大道及駿日街"
            },
            { 
                startPoint: "九龍塘又一城", 
                endPoint: "沙田大會堂", 
                route: "達之路、歌和老街、窩打老道、獅子山隧道、大涌橋路、沙田鄉事會路、源禾路及担杆莆街"
            },
            { 
                startPoint: "香港大球場", 
                endPoint: "荔枝角公共圖書館", 
                route: "加路連山道、連道、黃泥涌道、堅拿道天橋、紅磡海底隧道、加士居道天橋、西九龍走廊、荔枝角道、美荔道及荔灣道"
            },
            { 
                startPoint: "元朗形點 I", 
                endPoint: "港鐵大學站的士站", 
                route: "錦田公路、林錦公路、吐露港公路及澤祥街"
            },
            { 
                startPoint: "荃灣環宇海灣", 
                endPoint: "米埔自然保護區", 
                route: "荃灣路、屯門公路、大欖隧道、青朗公路、新田公路、青山公路米埔段及担竿洲路"
            },
            { 
                startPoint: "薄扶林數碼港", 
                endPoint: "灣仔胡忠大廈", 
                route: "數碼港道、沙灣徑、域多利道、沙宣道、薄扶林道、般咸道、堅道、上亞厘畢道、花園道、金鐘道及皇后大道東"
            },
            { 
                startPoint: "薄扶林華富邨", 
                endPoint: "大潭香港木球會", 
                route: "華富道、石排灣道、香港仔海傍道、南風道、深水灣道及黃泥涌峽道"
            },
            { 
                startPoint: "元朗大會堂", 
                endPoint: "馬鞍山新港城中心", 
                route: "青山公路、錦田公路、林錦公路、吐露港公路、大老山公路、馬鞍山路及西沙路"
            },
            { 
                startPoint: "大埔科學園", 
                endPoint: "鑽石山星河明居", 
                route: "科學園路、大老山公路、大老山隧道、鳳德道及龍蟠街"
            },
            { 
                startPoint: "香港文華東方酒店", 
                endPoint: "赤柱美利樓", 
                route: "遮打道、金鐘道、皇后大道東、司徒拔道、黃泥涌峽道、淺水灣道、赤柱峽道及赤柱村道"
            },
            { 
                startPoint: "何文田土木工程拓展署大樓", 
                endPoint: "九龍灣機電工程署總部大樓", 
                route: "忠孝街、佛光街、馬頭圍道、土瓜灣道、承啟道及啟成街"
            },
            { 
                startPoint: "紅磡置富都會", 
                endPoint: "北角廉政公署總部大樓", 
                route: "暢運道、科學館道、康莊道、紅磡海底隧道、東區走廊及渣華道"
            },
            { 
                startPoint: "香港體育學院", 
                endPoint: "荃灣城門谷運動場", 
                route: "源禾路、大埔公路沙田段、城門隧道、象山邨西路及城門道"
            },
            { 
                startPoint: "葵芳葵青劇院", 
                endPoint: "中環碼頭", 
                route: "荃灣路、青葵公路、西九龍公路、西區海底隧道、干諾道西及民光街"
            },
            { 
                startPoint: "基督教聯合醫院", 
                endPoint: "旺角區警署", 
                route: "協和街、順利邨道、新清水灣道、太子道東及太子道西"
            },
            { 
                startPoint: "佐敦(西九龍站)巴士總站", 
                endPoint: "銅鑼灣皇悅酒店", 
                route: "佐敦道、加士居道天橋、康莊道、紅磡海底隧道、維園道及永興街"
            },
            { 
                startPoint: "銅鑼灣禮頓山", 
                endPoint: "九龍城喇沙書院", 
                route: "黃泥涌道、堅拿道天橋、紅磡海底隧道、公主道、窩打老道、對衡道及喇沙利道"
            },
            { 
                startPoint: "將軍澳公共圖書館", 
                endPoint: "香港體育館", 
                route: "寶康路、將軍澳隧道、觀塘繞道、啟德隧道、東九龍走廊、漆咸道北及暢運道"
            },
            { 
                startPoint: "啟德工業貿易大樓", 
                endPoint: "高等法院", 
                route: "協調道、太子道東、漆咸道北、紅磡海底隧道、告士打道、分域街、軒尼詩道及金鐘道"
            },
            { 
                startPoint: "荃灣荃豐中心", 
                endPoint: "新蒲崗香港考試及評核局", 
                route: "青山公路荃灣段、青山公路葵涌段、呈祥道、龍翔道、蒲崗村道、彩虹道及爵祿街"
            },
            { 
                startPoint: "稅務中心", 
                endPoint: "牛頭角下邨", 
                route: "經協調道﹑承啟道﹑宏照道﹑啟祥道及牛頭角道"
            }
        ];

        // Get all unique locations for options
        const allLocations = [...new Set(locationQuizData.map(item => item.location))];
        const allRoutes = routeQuizData.map(item => item.route);
        
        const defaultCoordinate = { lat: 22.302711, lng: 114.177216 }
        // District coordinates
        const districtCoordinates = {
            // Hong Kong Island
            "中環": { lat: 22.2800, lng: 114.1588 },
            "金鐘": { lat: 22.2783, lng: 114.1647 },
            "灣仔": { lat: 22.2783, lng: 114.1747 },
            "銅鑼灣": { lat: 22.2825, lng: 114.1845 },
            "北角": { lat: 22.2913, lng: 114.1997 },
            "太古": { lat: 22.2866, lng: 114.2167 },
            "鰂魚涌": { lat: 22.2849, lng: 114.2109 },
            "西灣河": { lat: 22.2832, lng: 114.2225 },
            "筲箕灣": { lat: 22.2783, lng: 114.2289 },
            "柴灣": { lat: 22.2673, lng: 114.2395 },
            "上環": { lat: 22.2861, lng: 114.1504 },
            "西營盤": { lat: 22.2871, lng: 114.1431 },
            "薄扶林": { lat: 22.2699, lng: 114.1290 },
            "香港仔": { lat: 22.2483, lng: 114.1580 },
            "黃竹坑": { lat: 22.2483, lng: 114.1726 },
            "鴨脷洲": { lat: 22.2430, lng: 114.1553 },
            "赤柱": { lat: 22.2170, lng: 114.2131 },
            "大坑": { lat: 22.2775, lng: 114.1920 },
            "跑馬地": { lat: 22.2750, lng: 114.1880 },
            "山頂": { lat: 22.2750, lng: 114.1455 },
            "半山": { lat: 22.2789, lng: 114.1500 },
            "摩頓臺": { lat: 22.2789, lng: 114.1844 },
            "東院道": { lat: 22.2650, lng: 114.1850 },
            "莊士敦道": { lat: 22.2777, lng: 114.1704 },
            "干諾道西": { lat: 22.2872, lng: 114.1486 },
            "花園道": { lat: 22.2778, lng: 114.1583 },
            "般咸道": { lat: 22.2816, lng: 114.1400 },
            "德輔道中": { lat: 22.2846, lng: 114.1553 },
            "皇后大道中": { lat: 22.2817, lng: 114.1570 },
            "金鐘道": { lat: 22.2780, lng: 114.1665 },
            "皇后大道東": { lat: 22.2775, lng: 114.1723 },
            "軒尼詩道": { lat: 22.2780, lng: 114.1698 },
            "告士打道": { lat: 22.2792, lng: 114.1688 },
            "港灣道": { lat: 22.2797, lng: 114.1701 },
            "英皇道": { lat: 22.2883, lng: 114.2019 },
            "法院道": { lat: 22.2769, lng: 114.1619 },
            "黃泥涌峽道": { lat: 22.2577, lng: 114.1873 },
            
            // Kowloon
            "尖沙咀": { lat: 22.2983, lng: 114.1747 },
            "油麻地": { lat: 22.3122, lng: 114.1720 },
            "佐敦": { lat: 22.3050, lng: 114.1725 },
            "旺角": { lat: 22.3186, lng: 114.1690 },
            "大角咀": { lat: 22.3200, lng: 114.1614 },
            "深水埗": { lat: 22.3308, lng: 114.1622 },
            "長沙灣": { lat: 22.3341, lng: 114.1565 },
            "荔枝角": { lat: 22.3348, lng: 114.1433 },
            "紅磡": { lat: 22.3055, lng: 114.1868 },
            "九龍城": { lat: 22.3283, lng: 114.1914 },
            "馬頭圍": { lat: 22.3196, lng: 114.1851 },
            "土瓜灣": { lat: 22.3178, lng: 114.1902 },
            "九龍灣": { lat: 22.3222, lng: 114.2130 },
            "觀塘": { lat: 22.3112, lng: 114.2242 },
            "牛頭角": { lat: 22.3166, lng: 114.2153 },
            "藍田": { lat: 22.3061, lng: 114.2336 },
            "秀茂坪": { lat: 22.3271, lng: 114.2310 },
            "鑽石山": { lat: 22.3403, lng: 114.2014 },
            "黃大仙": { lat: 22.3422, lng: 114.1923 },
            "樂富": { lat: 22.3380, lng: 114.1870 },
            "何文田": { lat: 22.3185, lng: 114.1763 },
            "九龍塘": { lat: 22.3371, lng: 114.1772 },
            "太子": { lat: 22.3214, lng: 114.1694 },
            "上海街": { lat: 22.3156, lng: 114.1703 },
            "柯士甸道西": { lat: 22.3037, lng: 114.1658 },
            "河內道": { lat: 22.2970, lng: 114.1688 },
            "金巴利道": { lat: 22.2986, lng: 114.1736 },
            "深旺道": { lat: 22.3248, lng: 114.1616 },
            "博物館道": { lat: 22.2915, lng: 114.1728 },
            "太子道西": { lat: 22.3254, lng: 114.1657 },
            "沙田坳道": { lat: 22.3431, lng: 114.1921 },
            "忠孝街": { lat: 22.3164, lng: 114.1780 },
            "啟成街": { lat: 22.3222, lng: 114.2165 },
            "鴻圖道": { lat: 22.3094, lng: 114.2223 },
            "新寧道": { lat: 22.3135, lng: 114.1726 },
            "偉業街": { lat: 22.3233, lng: 114.2178 },
            "鯉魚門道": { lat: 22.3153, lng: 114.2280 },
            "啟祥道": { lat: 22.3242, lng: 114.2207 },
            "宏照道": { lat: 22.3265, lng: 114.2141 },
            "牛頭角道": { lat: 22.3319, lng: 114.2173 },
            "協調道": { lat: 22.3281, lng: 114.2089 },
            "承啟道": { lat: 22.3204, lng: 114.2080 },
            "暢運道": { lat: 22.3049, lng: 114.1822 },
            "海庭道": { lat: 22.3176, lng: 114.1543 },
            "通州街": { lat: 22.3171, lng: 114.1650 },
            "馬頭角道": { lat: 22.3216, lng: 114.1884 },
            "安華街": { lat: 22.3252, lng: 114.2190 },
            "聯運街": { lat: 22.3236, lng: 114.1712 },
            "亞皆老街": { lat: 22.3266, lng: 114.1794 },
            
            // New Territories
            "荃灣": { lat: 22.3736, lng: 114.1175 },
            "葵涌": { lat: 22.3627, lng: 114.1274 },
            "葵芳": { lat: 22.3573, lng: 114.1265 },
            "青衣": { lat: 22.3545, lng: 114.1093 },
            "深井": { lat: 22.3654, lng: 114.0574 },
            "荃景圍": { lat: 22.3727, lng: 114.1158 },
            "青松觀路": { lat: 22.3928, lng: 113.9775 },
            "馬灣": { lat: 22.3520, lng: 114.0590 },
            "屯門": { lat: 22.3911, lng: 113.9692 },
            "元朗": { lat: 22.4431, lng: 114.0228 },
            "天水圍": { lat: 22.4630, lng: 114.0001 },
            "沙田": { lat: 22.3833, lng: 114.1965 },
            "大圍": { lat: 22.3728, lng: 114.1781 },
            "馬鞍山": { lat: 22.4246, lng: 114.2292 },
            "大埔": { lat: 22.4518, lng: 114.1640 },
            "粉嶺": { lat: 22.4941, lng: 114.1415 },
            "上水": { lat: 22.5037, lng: 114.1270 },
            "將軍澳": { lat: 22.3156, lng: 114.2539 },
            "調景嶺": { lat: 22.3047, lng: 114.2515 },
            "西貢": { lat: 22.3798, lng: 114.2712 },
            "大嶼山": { lat: 22.2578, lng: 113.9531 },
            "東涌": { lat: 22.2859, lng: 113.9415 },
            "赤鱲角": { lat: 22.3089, lng: 113.9213 },
            "竹篙灣": { lat: 22.3289, lng: 114.0445 },
            "昂坪": { lat: 22.2547, lng: 113.9022 },
            "澤祥街": { lat: 22.4131, lng: 114.2093 },
            "楊屋道": { lat: 22.3692, lng: 114.1133 },
            "震寰路": { lat: 22.3911, lng: 113.9760 },
            "車公廟路": { lat: 22.3689, lng: 114.1865 },
            "龍琛路": { lat: 22.5023, lng: 114.1289 },
            "汀角路": { lat: 22.4516, lng: 114.1706 },
            "朗日路": { lat: 22.4484, lng: 114.0243 },
            "天壇街": { lat: 22.4538, lng: 114.0001 },
            "松仁路": { lat: 22.2807, lng: 113.9413 },
            "達東路": { lat: 22.2803, lng: 113.9425 },
            "怡東路": { lat: 22.2865, lng: 113.9402 },
            "富健街": { lat: 22.3828, lng: 114.1926 },
            "小瀝源路": { lat: 22.3889, lng: 114.2103 },
            "上禾輋路": { lat: 22.3810, lng: 114.1875 },
            "安平街": { lat: 22.3810, lng: 114.1895 },
            "源禾路": { lat: 22.3817, lng: 114.1854 },
            "亞公角街": { lat: 22.3841, lng: 114.1972 },
            "宜正里": { lat: 22.3827, lng: 114.1908 },
            "翠嶺里": { lat: 22.4079, lng: 114.2227 },
            "寶林": { lat: 22.3139, lng: 114.2558 },
            "寶寧里": { lat: 22.3173, lng: 114.2670 },
            "寶琳北路": { lat: 22.3174, lng: 114.2601 },
            "唐德街": { lat: 22.3072, lng: 114.2597 },
            "屯喜路": { lat: 22.3944, lng: 113.9739 },
            "屯順街": { lat: 22.3937, lng: 113.9771 },
            "龍門路": { lat: 22.3872, lng: 113.9705 },
            "青敬路": { lat: 22.3598, lng: 114.1086 },
            "西沙路": { lat: 22.4283, lng: 114.2314 },
            "青葵公路": { lat: 22.3605, lng: 114.1379 },
            "葵涌道": { lat: 22.3675, lng: 114.1307 },
            "興芳路": { lat: 22.3631, lng: 114.1315 },
            "荔灣道": { lat: 22.3396, lng: 114.1463 },
            "西樓角路": { lat: 22.3701, lng: 114.1177 },
            "元州街": { lat: 22.3387, lng: 114.1582 },
            "橋樂坊": { lat: 22.4433, lng: 114.0343 },
            "安邦路": { lat: 22.4466, lng: 114.1636 },
            "璧峰路": { lat: 22.4912, lng: 114.1429 },
            "環保大道": { lat: 22.3090, lng: 114.2607 },
            "寶邑路": { lat: 22.3191, lng: 114.2674 },
            "全安路": { lat: 22.4509, lng: 114.1711 },
            "銀鑛灣路": { lat: 22.2684, lng: 113.9935 },
            "承豐道": { lat: 22.3044, lng: 114.2164 },
            "親民街": { lat: 22.3817, lng: 114.2739 },
        };

        // Quiz variables
        let currentQuizType = null; // 'location' or 'route'
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        const questionsPerQuiz = 20; // Change this to adjust quiz length
        let quizQuestions = [];

        // Mistakes storage - use localStorage to persist between sessions
        let savedMistakes = [];

        // Load saved mistakes from localStorage
        function loadSavedMistakes() {
            try {
                const storedMistakes = localStorage.getItem('taxiQuizMistakes');
                if (storedMistakes) {
                    savedMistakes = JSON.parse(storedMistakes);
                    updateMistakesCount();
                }
            } catch (e) {
                console.error("Error loading saved mistakes:", e);
                savedMistakes = [];
            }
        }

        // Save mistakes to localStorage
        function saveMistakesToStorage() {
            try {
                localStorage.setItem('taxiQuizMistakes', JSON.stringify(savedMistakes));
                updateMistakesCount();
            } catch (e) {
                console.error("Error saving mistakes:", e);
            }
        }

        // Update the mistakes count in the menu
        function updateMistakesCount() {
            const countElement = document.getElementById('mistakes-count');
            if (countElement) {
                countElement.textContent = savedMistakes.length;
            }
        }

        // Add a new mistake to the saved list (ensure no duplicates)
        function addMistake(question, userAnswer) {
            // Create a unique ID for the question to avoid duplicates
            let questionId;
            
            if (question.hasOwnProperty('place')) {
                // Location question
                questionId = `location-${question.place}`;
            } else {
                // Route question
                questionId = `route-${question.startPoint}-${question.endPoint}`;
            }
            
            // Check if this question is already in the saved mistakes
            const existingIndex = savedMistakes.findIndex(item => item.id === questionId);
            
            if (existingIndex !== -1) {
                // Update existing mistake with the newest answer
                savedMistakes[existingIndex].userAnswer = userAnswer;
            } else {
                // Add new mistake
                savedMistakes.push({
                    id: questionId,
                    question: question,
                    userAnswer: userAnswer,
                    type: question.hasOwnProperty('place') ? 'location' : 'route',
                    timestamp: new Date().toISOString()
                });
            }
            
            // Save to localStorage
            saveMistakesToStorage();
        }

        // Clear all saved mistakes
        function clearMistakes() {
            savedMistakes = [];
            saveMistakesToStorage();
            showMistakes(); // Refresh the mistakes view
        }

        // Show mistakes in the mistakes container
        function showMistakes() {
            const mistakesContainer = document.getElementById('mistakes-container');
            const mistakesList = document.getElementById('mistakes-list');
            const noMistakesMsg = document.getElementById('no-mistakes-msg');
            
            // Show container
            quizSelection.classList.add('hidden');
            quizContainer.classList.add('hidden');
            summaryContainer.classList.add('hidden');
            mistakesContainer.classList.remove('hidden');
            
            // Clear the list
            mistakesList.innerHTML = '';
            
            // Get filter settings
            const showLocation = document.getElementById('show-location').checked;
            const showRoute = document.getElementById('show-route').checked;
            
            // Filter mistakes based on settings
            const filteredMistakes = savedMistakes.filter(mistake => 
                (showLocation && mistake.type === 'location') || 
                (showRoute && mistake.type === 'route')
            );
            
            // Show message if no mistakes
            if (filteredMistakes.length === 0) {
                noMistakesMsg.classList.remove('hidden');
            } else {
                noMistakesMsg.classList.add('hidden');
                
                // Create entries for each mistake
                filteredMistakes.forEach((mistake, index) => {
                    const mistakeDiv = document.createElement('div');
                    mistakeDiv.className = 'p-4 rounded-lg border border-red-500 bg-red-50 dark:bg-red-900/20';
                    mistakeDiv.setAttribute('data-mistake-id', mistake.id);
                    
                    // Create grid for question and map (for location questions)
                    const gridDiv = document.createElement('div');
                    gridDiv.className = 'grid grid-cols-1 md:grid-cols-3 gap-4';
                    
                    // Question info
                    const questionInfo = document.createElement('div');
                    questionInfo.className = 'md:col-span-1';
                    
                    // Question header
                    const questionHeader = document.createElement('h3');
                    questionHeader.className = 'text-lg font-bold mb-2';
                    
                    if (mistake.type === 'location') {
                        questionHeader.textContent = mistake.question.place;
                    } else {
                        questionHeader.textContent = `${mistake.question.startPoint} → ${mistake.question.endPoint}`;
                    }
                    questionInfo.appendChild(questionHeader);
                    
                    // Correct answer
                    const correctAnswer = document.createElement('p');
                    correctAnswer.className = 'text-green-600 dark:text-green-400 mb-1';
                    if (mistake.type === 'location') {
                        correctAnswer.innerHTML = `<strong>正確答案:</strong> ${mistake.question.location}`;
                    } else {
                        correctAnswer.innerHTML = `<strong>正確答案:</strong> ${mistake.question.route}`;
                    }
                    questionInfo.appendChild(correctAnswer);
                    
                    // User answer
                    const userAnswerEl = document.createElement('p');
                    userAnswerEl.className = 'text-red-600 dark:text-red-400';
                    userAnswerEl.innerHTML = `<strong>你的答案:</strong> ${mistake.userAnswer || "未作答"}`;
                    questionInfo.appendChild(userAnswerEl);
                    
                    gridDiv.appendChild(questionInfo);
                    
                    // Add map for location questions
                    if (mistake.type === 'location') {
                        const mapDiv = document.createElement('div');
                        mapDiv.className = 'summary-map';
                        mapDiv.id = `mistake-map-${index}`;
                        gridDiv.appendChild(mapDiv);
                        
                        // Set timeout to create map after DOM has been updated
                        setTimeout(() => {
                            // Coordinates
                            const correctLocationKey = mistake.question.location;
                            const correctCoords = [mistake.question.lat, mistake.question.lng]
                            
                            // Check if wrong answer exists
                            const userCoords = mistake.userAnswer && (districtCoordinates[mistake.userAnswer] || defaultCoordinate);
                            const mistakeMap = L.map(document.getElementById(`mistake-map-${index}`)).setView(correctCoords, 14);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '© OpenStreetMap contributors'
                            }).addTo(mistakeMap);

                            // Add marker for correct location
                            const correctMarker = L.marker(correctCoords, {
                                title: `${mistake.question.place}`,
                                icon: L.divIcon({
                                    className: 'custom-div-icon',
                                    html: `<div style="background-color:#4CAF50;width:16px;height:16px;border-radius:50%;"></div>`,
                                    iconSize: [16, 16],
                                    iconAnchor: [8, 8]
                                })
                            }).addTo(mistakeMap);

                            // Popup for correct location
                            correctMarker.bindPopup(`<div class="p-1">
                                <strong>${correctLocationKey} - ${mistake.question.place}</strong>
                            </div>`);

                            if (mistake.userAnswer) {
                                // Add marker for user's incorrect answer
                                const incorrectMarker = L.marker([userCoords.lat, userCoords.lng], {
                                    title: `${mistake.question.place} (你的選擇)`,
                                    icon: L.divIcon({
                                        className: 'custom-div-icon',
                                        html: `<div style="background-color:#F44336;width:16px;height:16px;border-radius:50%;"></div>`,
                                        iconSize: [16, 16],
                                        iconAnchor: [8, 8]
                                    })
                                }).addTo(mistakeMap);
                                // Popup for incorrect answer
                                incorrectMarker.bindPopup(`<div class="p-1">
                                    <strong>${mistake.userAnswer}</strong>
                                </div>`);

                                // Fit map to show both locations
                                const bounds = L.latLngBounds(
                                    correctCoords,
                                    [userCoords.lat, userCoords.lng]
                                );
                                mistakeMap.fitBounds(bounds)
                                //mistakeMap.zoomOut(1);
                            }
                            
                            setTimeout(() => {
                                correctMarker.openPopup();
                            }, 500);
                        }, 200 + (index * 100)); // Stagger map creation
                    }
                    
                    mistakeDiv.appendChild(gridDiv);
                    mistakesList.prepend(mistakeDiv);
                });
            }
        }

        // DOM elements
        const quizSelection = document.getElementById('quiz-selection');
        const quizContainer = document.getElementById('quiz-container');
        const summaryContainer = document.getElementById('summary-container');
        const mistakesContainer = document.getElementById('mistakes-container');
        
        const questionContainer = document.getElementById('question-container');
        const optionsContainer = document.getElementById('options-container');
        const feedbackElement = document.getElementById('feedback');
        const progressBar = document.getElementById('progress-bar');
        const questionNumberElement = document.getElementById('question-number');
        const totalQuestionsElement = document.getElementById('total-questions');
        const scoreElement = document.getElementById('score');
        const questionNav = document.getElementById('question-nav');
        
        const prevButton = document.getElementById('prev-btn');
        const skipButton = document.getElementById('skip-btn');
        const nextButton = document.getElementById('next-btn');

        // Event listeners for quiz type selection
        document.getElementById('location-quiz-btn').addEventListener('click', () => {
            startQuiz('location');
        });

        document.getElementById('route-quiz-btn').addEventListener('click', () => {
            startQuiz('route');
        });
        
        // Event listeners for mistakes review
        document.getElementById('review-mistakes-btn').addEventListener('click', showMistakes);
        document.getElementById('mistakes-back-btn').addEventListener('click', backToSelection);
        document.getElementById('clear-mistakes-btn').addEventListener('click', clearMistakes);
        
        // Filters for mistakes
        document.getElementById('show-location').addEventListener('change', showMistakes);
        document.getElementById('show-route').addEventListener('change', showMistakes);

        // Function to shuffle array
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Start quiz
        function startQuiz(quizType) {
            currentQuizType = quizType;
            
            // Hide selection, show quiz
            quizSelection.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            summaryContainer.classList.add('hidden');
            mistakesContainer.classList.add('hidden');
            
            // Select and shuffle questions based on quiz type
            if (quizType === 'location') {
                quizQuestions = shuffleArray(locationQuizData).slice(0, questionsPerQuiz);
            } else {
                quizQuestions = shuffleArray(routeQuizData).slice(0, questionsPerQuiz);
            }
            
            // Initialize quiz state
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = new Array(quizQuestions.length).fill(null);
            
            // Update UI
            totalQuestionsElement.textContent = questionsPerQuiz;
            questionNumberElement.textContent = 1;
            scoreElement.textContent = 0;
            
            // Create question navigation
            createQuestionNav();
            
            // Load first question
            loadQuestion();
        }

        // Create question navigation
        function createQuestionNav() {
            questionNav.innerHTML = '';
            
            for (let i = 0; i < quizQuestions.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.className = 'w-8 h-8 rounded-full text-sm flex items-center justify-center transition-colors';
                updateQuestionNavButton(btn, i);
                
                btn.addEventListener('click', () => {
                    currentQuestionIndex = i;
                    loadQuestion();
                    updateQuestionNav();
                });
                
                questionNav.appendChild(btn);
            }
        }

        // Update question navigation buttons
        function updateQuestionNav() {
            const buttons = questionNav.querySelectorAll('button');
            buttons.forEach((btn, index) => {
                updateQuestionNavButton(btn, index);
            });
        }

        // Update individual question nav button
        function updateQuestionNavButton(btn, index) {
            // Clear existing classes
            btn.className = 'w-8 h-8 rounded-full text-sm flex items-center justify-center transition-colors';
            
            // Current question
            if (index === currentQuestionIndex) {
                btn.classList.add('bg-primary', 'text-white', 'font-bold');
            } 
            // Answered correctly
            else if (userAnswers[index] !== null) {
                if (isAnswerCorrect(index)) {
                    btn.classList.add('bg-green-100', 'dark:bg-green-900', 'text-green-800', 'dark:text-green-200', 'border', 'border-green-500');
                } else {
                    btn.classList.add('bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200', 'border', 'border-red-500');
                }
            }
            // Unanswered
            else {
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            }
        }

        // Check if an answer is correct
        function isAnswerCorrect(index) {
            const question = quizQuestions[index];
            const userAnswer = userAnswers[index];
            
            if (currentQuizType === 'location') {
                return userAnswer === question.location;
            } else {
                return userAnswer === question.route;
            }
        }

        // Load question
        function loadQuestion() {
            const currentQuestion = quizQuestions[currentQuestionIndex];
            const questionElement = document.getElementById('question');
            
            // Hide map container when loading a new question
            mapContainer.classList.add('hidden');
            
            // Set question text based on quiz type
            if (currentQuizType === 'location') {
                questionElement.textContent = currentQuestion.place;
                loadLocationOptions(currentQuestion);
            } else {
                questionElement.innerHTML = `${currentQuestion.startPoint} <span class="text-primary">→</span> ${currentQuestion.endPoint}`;
                loadRouteOptions(currentQuestion);
            }
            
            // Update progress bar
            progressBar.style.width = `${((currentQuestionIndex + 1) / questionsPerQuiz) * 100}%`;
            
            // Update question number
            questionNumberElement.textContent = currentQuestionIndex + 1;
            
            // Handle buttons state
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.disabled = currentQuestionIndex === quizQuestions.length - 1;
            skipButton.disabled = currentQuestionIndex === quizQuestions.length - 1;
            
            // Hide feedback
            feedbackElement.classList.add('hidden');
            
            // Update question nav
            updateQuestionNav();
        }

        // Load options for location quiz
        function loadLocationOptions(question) {
            // Get incorrect options (3 random locations different from the correct one)
            const incorrectOptions = allLocations
                .filter(location => location !== question.location)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            // Combine correct and incorrect options and shuffle
            const options = shuffleArray([question.location, ...incorrectOptions]);
            
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Create option buttons
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'w-full py-3 px-4 border rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors';
                
                // If this question has been answered, show the result
                if (userAnswers[currentQuestionIndex] !== null) {
                    if (option === question.location) {
                        button.classList.add('bg-green-100', 'dark:bg-green-900', 'border-green-500');
                    } else if (option === userAnswers[currentQuestionIndex]) {
                        button.classList.add('bg-red-100', 'dark:bg-red-900', 'border-red-500');
                    }
                    button.disabled = true;
                } else {
                    // Add click event for new answer
                    button.addEventListener('click', () => selectAnswer(option));
                }
                
                optionsContainer.appendChild(button);
            });
        }

        // Load options for route quiz
        function loadRouteOptions(question) {
            // Get incorrect options (3 random routes different from the correct one)
            const incorrectOptions = allRoutes
                .filter(route => route !== question.route)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            // Combine correct and incorrect options and shuffle
            const options = shuffleArray([question.route, ...incorrectOptions]);
            
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Create option buttons
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'w-full py-3 px-4 border rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm';
                
                // If this question has been answered, show the result
                if (userAnswers[currentQuestionIndex] !== null) {
                    if (option === question.route) {
                        button.classList.add('bg-green-100', 'dark:bg-green-900', 'border-green-500');
                    } else if (option === userAnswers[currentQuestionIndex]) {
                        button.classList.add('bg-red-100', 'dark:bg-red-900', 'border-red-500');
                    }
                    button.disabled = true;
                } else {
                    // Add click event for new answer
                    button.addEventListener('click', () => selectAnswer(option));
                }
                
                optionsContainer.appendChild(button);
            });
        }

        // Select answer
        function selectAnswer(selectedOption) {
            const currentQuestion = quizQuestions[currentQuestionIndex];
            let isCorrect = false;
            
            // Check if answer is correct based on quiz type
            if (currentQuizType === 'location') {
                isCorrect = selectedOption === currentQuestion.location;
            } else {
                isCorrect = selectedOption === currentQuestion.route;
            }
            
            // Save answer
            userAnswers[currentQuestionIndex] = selectedOption;
            
            // Update score
            if (isCorrect) {
                score++;
                scoreElement.textContent = score;
            } else {
                // Save to mistakes history if incorrect
                addMistake(currentQuestion, selectedOption);
            }
            
            // Show feedback
            if (currentQuizType === 'location') {
                feedbackElement.textContent = isCorrect 
                    ? `✓ 正確！${currentQuestion.place}位於${currentQuestion.location}。` 
                    : `✗ 不正確。${currentQuestion.place}位於${currentQuestion.location}，不是${selectedOption}。`;
                
                // Show map for location quiz
                showLocationMap(currentQuestion);
            } else {
                feedbackElement.textContent = isCorrect 
                    ? `✓ 正確！從${currentQuestion.startPoint}到${currentQuestion.endPoint}的最直接路線是：${currentQuestion.route}。` 
                    : `✗ 不正確。從${currentQuestion.startPoint}到${currentQuestion.endPoint}的最直接路線是：${currentQuestion.route}。`;
            }
            
            feedbackElement.className = `mb-4 p-4 rounded-lg ${isCorrect ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'}`;
            feedbackElement.classList.remove('hidden');
            
            // Update options to show correct/incorrect
            const options = optionsContainer.querySelectorAll('button');
            options.forEach(button => {
                button.disabled = true;
                
                if (currentQuizType === 'location') {
                    if (button.textContent === currentQuestion.location) {
                        button.classList.add('bg-green-100', 'dark:bg-green-900', 'border-green-500');
                    } else if (button.textContent === selectedOption && !isCorrect) {
                        button.classList.add('bg-red-100', 'dark:bg-red-900', 'border-red-500');
                    }
                } else {
                    if (button.textContent === currentQuestion.route) {
                        button.classList.add('bg-green-100', 'dark:bg-green-900', 'border-green-500');
                    } else if (button.textContent === selectedOption && !isCorrect) {
                        button.classList.add('bg-red-100', 'dark:bg-red-900', 'border-red-500');
                    }
                }
            });
            
            // Update question nav
            updateQuestionNav();
            
            // Enable next button if we're not on the last question
            if (currentQuestionIndex < quizQuestions.length - 1) {
                nextButton.disabled = false;
            } else if (allQuestionsAnswered()) {
                // If all questions are answered, show a "Finish" button
                nextButton.textContent = "完成測驗";
                nextButton.disabled = false;
            }
        }

        // Show location on map using district coordinates
        function showLocationMap(currentQuestion) {
            // Only show map for location quiz
            if (currentQuizType !== 'location') return;
            
            mapContainer.classList.remove('hidden');
            
            // Get the specific district or street coordinates for the correct answer
            const correctLocationKey = currentQuestion.location;
            const correctCoords = [currentQuestion.lat, currentQuestion.lng] || defaultCoordinate;
            
            // Get the user's answer if there is one and it's incorrect
            const userAnswer = userAnswers[currentQuestionIndex];
            const isIncorrect = userAnswer !== null && userAnswer !== correctLocationKey;
            const userCoords = isIncorrect ? (districtCoordinates[userAnswer] || defaultCoordinate) : null;
            
            // If map doesn't exist, create it
            if (!map) {
                map = L.map(mapElement).setView(correctCoords, 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
            } else {
                // Otherwise just update the center
                map.setView(correctCoords, 15);
                
                // Clear any existing markers
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });
            }
            
            // If we're showing both locations (incorrect answer scenario)
            if (isIncorrect && userCoords) {
                // Add marker for correct location (green)
                const correctMarker = L.marker(correctCoords, {
                    title: `${currentQuestion.place} (正確位置)`,
                    icon: L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div style="background-color:#4CAF50;width:20px;height:20px;border-radius:50%;"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                }).addTo(map);
                
                // Add marker for incorrect location (red)
                const incorrectMarker = L.marker([userCoords.lat, userCoords.lng], {
                    title: `${currentQuestion.place} (你的選擇)`,
                    icon: L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div style="background-color:#F44336;width:20px;height:20px;border-radius:50%;"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    })
                }).addTo(map);
                
                // Fit map to show both markers
                const bounds = L.latLngBounds(
                    correctCoords,
                    [userCoords.lat, userCoords.lng]
                );
                map.fitBounds(bounds);
                //map.zoomOut(1);
                
                // Add popups
                correctMarker.bindPopup(`<div class="p-2">
                    <strong>${correctLocationKey}</strong> - ${currentQuestion.place}<br>
                    <span class="text-green-600">✓ 正確位置</span>
                </div>`);
                
                incorrectMarker.bindPopup(`<div class="p-2">
                    <strong>${userAnswer}</strong><br>
                    <span class="text-red-600">✗ 你的選擇</span>
                </div>`);
                
                // Open both popups with a delay
                setTimeout(() => {
                    correctMarker.openPopup();
                    // Slight delay for second window to avoid overlap/flickering
                    setTimeout(() => {
                        incorrectMarker.openPopup();
                    }, 300);
                }, 500);
                
            } else {
                // Just show the correct location
                const marker = L.marker(correctCoords, {
                    title: currentQuestion.place
                }).addTo(map);
                
                // Add popup with location
                marker.bindPopup(`<div class="p-2">
                    <strong>${correctLocationKey}</strong> - ${currentQuestion.place}
                </div>`);

                // Automatically open popup
                setTimeout(() => {
                    marker.openPopup();
                }, 500);

            }
            
            // Trigger resize event to ensure map renders correctly
            setTimeout(() => {
                map.invalidateSize();
            }, 100);
        }

        // Skip question
        function skipQuestion() {
            if (currentQuestionIndex < quizQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        // Go to next question
        function nextQuestion() {
            if (currentQuestionIndex < 19) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        // Go to previous question
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        // Check if all questions are answered
        function allQuestionsAnswered() {
            return userAnswers.every(answer => answer !== null);
        }

        // Show summary view
        function showSummary() {
            // Hide quiz container and results container
            quizContainer.classList.add('hidden');
            mistakesContainer.classList.add('hidden');
            
            // Show summary container
            summaryContainer.classList.remove('hidden');
            
            // Update score display
            document.getElementById('summary-score').textContent = score;
            document.getElementById('summary-total').textContent = quizQuestions.length;
            
            // Get the summary questions container
            const summaryQuestionsContainer = document.getElementById('summary-questions');
            summaryQuestionsContainer.innerHTML = '';
            
            // Add each question to the summary
            quizQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer !== null && isAnswerCorrect(index);
                
                // Create question container
                const questionDiv = document.createElement('div');
                questionDiv.className = 'p-4 rounded-lg border ' + 
                    (isCorrect ? 'border-green-500 bg-green-50 dark:bg-green-900/20' : 
                    userAnswer === null ? 'border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20' : 
                    'border-red-500 bg-red-50 dark:bg-red-900/20');
                
                // Create grid for question and map
                const gridDiv = document.createElement('div');
                gridDiv.className = 'grid grid-cols-1 md:grid-cols-3 gap-4';
                
                // Question info
                const questionInfo = document.createElement('div');
                questionInfo.className = 'md:col-span-1';
                
                // Question number and content
                const questionHeader = document.createElement('h3');
                questionHeader.className = 'text-lg font-bold mb-2';
                
                if (currentQuizType === 'location') {
                    questionHeader.innerHTML = `題目 ${index + 1}:<br/>${question.place}`;
                } else {
                    questionHeader.innerHTML = `題目 ${index + 1}:<br/>${question.startPoint} → ${question.endPoint}`;
                }
                questionInfo.appendChild(questionHeader);
                
                // Correct answer
                const correctAnswer = document.createElement('p');
                correctAnswer.className = 'text-green-600 dark:text-green-400 mb-1';
                if (currentQuizType === 'location') {
                    correctAnswer.innerHTML = `<strong>正確答案:</strong> ${question.location}`;
                } else {
                    correctAnswer.innerHTML = `<strong>正確答案:</strong> ${question.route}`;
                }
                questionInfo.appendChild(correctAnswer);
                
                // User answer
                const userAnswerEl = document.createElement('p');
                if (userAnswer === null) {
                    userAnswerEl.className = 'text-yellow-600 dark:text-yellow-400';
                    userAnswerEl.innerHTML = '<strong>你的答案:</strong> 未作答';
                    // Add to wrong question bank
                    addMistake(question, userAnswer)

                } else if (isCorrect) {
                    userAnswerEl.className = 'text-green-600 dark:text-green-400';
                    userAnswerEl.innerHTML = `<strong>你的答案:</strong> ${userAnswer}`;
                } else {
                    userAnswerEl.className = 'text-red-600 dark:text-red-400';
                    userAnswerEl.innerHTML = `<strong>你的答案:</strong> ${userAnswer}`;
                }
                questionInfo.appendChild(userAnswerEl);
                
                gridDiv.appendChild(questionInfo);
                
                // Map for location quiz
                if (currentQuizType === 'location') {
                    const mapDiv = document.createElement('div');
                    mapDiv.className = 'summary-map';
                    mapDiv.id = `summary-map-${index}`;
                    gridDiv.appendChild(mapDiv);
                    
                    // Set timeout to create map after DOM has been updated
                    setTimeout(() => {
                        // Coordinates
                        const correctLocationKey = question.location;
                        const correctCoords = [question.lat, question.lng] || defaultCoordinate;
                        
                        // Check if wrong answer exists
                        const isIncorrect = userAnswer !== null && userAnswer !== correctLocationKey;
                        const userCoords = isIncorrect ? (districtCoordinates[userAnswer] || defaultCoordinate) : null;
                        
                        // Create map
                        const summaryMap = L.map(document.getElementById(`summary-map-${index}`)).setView(correctCoords, 14);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '© OpenStreetMap contributors'
                        }).addTo(summaryMap);
                        
                        // Add marker for correct location
                        const correctMarker = L.marker(correctCoords, {
                            title: `${question.place}`
                        });
                        
                        if (isIncorrect) {
                            correctMarker.setIcon(L.divIcon({
                                className: 'custom-div-icon',
                                html: `<div style="background-color:#4CAF50;width:16px;height:16px;border-radius:50%;"></div>`,
                                iconSize: [16, 16],
                                iconAnchor: [8, 8]
                            }));
                        }
                        correctMarker.addTo(summaryMap);
                        
                        // Popup for correct location
                        correctMarker.bindPopup(`<div class="p-1">
                            <strong>${correctLocationKey}${question.place}</strong>
                        </div>`);
                        
                        // If user answer is incorrect, show that marker too
                        if (isIncorrect && userCoords) {
                            const incorrectMarker = L.marker([userCoords.lat, userCoords.lng], {
                                title: `${question.place} (你的選擇)`,
                                icon: L.divIcon({
                                    className: 'custom-div-icon',
                                    html: `<div style="background-color:#F44336;width:16px;height:16px;border-radius:50%;"></div>`,
                                    iconSize: [16, 16],
                                    iconAnchor: [8, 8]
                                })
                            }).addTo(summaryMap);
                            
                            // Popup for incorrect answer
                            incorrectMarker.bindPopup(`<div class="p-1">
                                <strong>${userAnswer}</strong>
                            </div>`);
                            
                            // Fit map to show both locations
                            const bounds = L.latLngBounds(
                                correctCoords,
                                [userCoords.lat, userCoords.lng]
                            );
                            summaryMap.fitBounds(bounds)
                            //summaryMap.zoomOut(1);
                            
                            // Open both popups
                            setTimeout(() => {
                                correctMarker.openPopup();
                                setTimeout(() => {
                                    incorrectMarker.openPopup();
                                }, 200);
                            }, 500);
                        } else {
                            // Just open the correct location popup
                            setTimeout(() => {
                                correctMarker.openPopup();
                            }, 500);
                        }
                    }, 200 + (index * 100)); // Stagger map creation to prevent too many simultaneous requests
                }
                
                questionDiv.appendChild(gridDiv);
                summaryQuestionsContainer.appendChild(questionDiv);
            });
        }

        // Reset to selection screen
        function backToSelection() {
            quizContainer.classList.add('hidden');
            summaryContainer.classList.add('hidden');
            mistakesContainer.classList.add('hidden');
            quizSelection.classList.remove('hidden');
        }

        // Add event listeners
        document.getElementById('exit-btn').addEventListener('click', backToSelection);
        document.getElementById('submit-btn').addEventListener('click', showSummary);
        document.getElementById('summary-back-btn').addEventListener('click', backToSelection);
        skipButton.addEventListener('click', skipQuestion);
        nextButton.addEventListener('click', nextQuestion);
        prevButton.addEventListener('click', prevQuestion);
        
        // Initialize by loading saved mistakes
        loadSavedMistakes();
    </script>


</body></html>
